# [pro-app](https://jeryqwq.github.io/build-docs/#/)

线上资源：[主应用](https://jeryqwq.github.io/main/#/dash) [子应用](https://jeryqwq.github.io/template/) [在线文档](https://jeryqwq.github.io/build-docs#/)

## PlatForm & Tools

### 我们推荐

[![](https://img.shields.io/badge/OS-Monterey-A936CC?style=flat-square&logo=Apple)](https://www.apple.com/macos/monterey/) [![](https://img.shields.io/badge/Shell%20-OhMyZsh-C5D928?style=flat-square&logo=image%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw%2FeHBhY2tldCBiZWdpbj0i77u%2FIiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8%2BIDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTExIDc5LjE1ODMyNSwgMjAxNS8wOS8xMC0wMToxMDoyMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkE3MDg2QTAyQUZCMzExRTVBMkQxRDMzMkJDMUQ4RDk3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkE3MDg2QTAzQUZCMzExRTVBMkQxRDMzMkJDMUQ4RDk3Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QTcwODZBMDBBRkIzMTFFNUEyRDFEMzMyQkMxRDhEOTciIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QTcwODZBMDFBRkIzMTFFNUEyRDFEMzMyQkMxRDhEOTciLz4gPC9yZGY6RGVzY3JpcHRpb24%2BIDwvcmRmOlJERj4gPC94OnhtcG1ldGE%2BIDw%2FeHBhY2tldCBlbmQ9InIiPz6lm45hAAADkklEQVR42qyVa0yTVxzGn7d9Wy03MS2ii8s%2BeokYNQSVhCzOjXZOFNF4jx%2BMRmPUMEUEqVG36jo2thizLSQSMd4N8ZoQ8RKjJtooaCpK6ZoCtRXKpRempbTv5ey83bhkAUphz8fznvP8znn%2B%2F3NeEEJgNBoRRSmz0ub%2FfuxEacBg%2FDmYtiCjgo5NG2mBXq%2BH5I1ogMRk9Zbd%2BQU2e1ML6VPLOyf5tvBQ8yT1lG10imxsABm7SLs898GTpyYynEzP60hO3trHDKvMigUwdeaceacqzp7nOI4n0SSIIjl36ao4Z356OV07fSQAk6xJ3XGg%2BLCr1d1OYlVHp4eUHPnerU79ZA%2F1kuv1JQMAg%2BE4O2P23EumF3VkvHprsZKMzKwbRUXFEyTvSIEmTVbrysp%2BWr8wfQHGK6WChVa3bKUmdWou%2BjpArdGkzZ41c1zG%2Fu5uGH4swzd561F%2BuhIT4%2BLnSuPsv9%2BJKIpjNr9dXYOyk7%2FBZrcjIT4eCnoKgedJP4BEqhG77E3NKP31FO7cfQA5K0dSYuLgz2TwCWJSOBzG6crzKK%2BohNfni%2Bx6OMUMMNe%2Fgf7ocbw0v0acKg6J8Ql0q%2BT%2FAXR5PNi5dz9c71upuQqCKFAD%2BYhrZLEAmpodaHO3Qy6TI3NhBpbrshGtOWKOSMYwYGQM8nJzoFJNxP2HjyIQho4PewK6hBktoDcUwtIln4PjOWzflQ%2Be5yl0yCCYgYikTclGlxadio%2BBQCSiW1UXoVGrKYwH4RgMrjU1HAB4vR6LzWYfFUCKxfS8Ftk5qxHoCUQAUkRJaSEokkV6Y%2F%2BJUOC4hn6A39NVXVBYeNP8piH6HeA4fPbpdBQV5KOx0QaL1YppX3Jgk0TwH2Vg6S3u%2BdB91%2B%2FpuNYPYFl5uP5V7ZqvsrX7jxqMXR6ff3gCQSTzFI0a1TX3wIs8ul%2Bq4HuWAAiM39vhOuR1O1fQ2gT%2F26Z8Z5vrl2OHi9OXZn995nLV9aFfS6UC9JeJPfuK0NBohWpCHMSAAsFe74WWP%2BvT25wtP9Bpob6uGqqyDnOtaeumjRu%2ByFu36VntK%2FPA5umTJeUtPWZSU9BCgud661odVp3DZtkc7AnYR33RRC708PrVi1larW7XwZIjLnd7R6SgSqWSNjU1B3F72pz5TZbXmX5vV81Yb7Lg7XT%2FUXriu8XLVqw6c6XqWnBKiiYU%2BMt3wWF7u7i91XlSEITwSAZ%2FCzAAHsJVbwXYFFEAAAAASUVORK5CYII%3D)](https://ohmyz.sh/) [![](https://img.shields.io/badge/CodeEditor-Visual%20Studio%20Code-2966B2?style=flat-square&logo=Visual-Studio-Code)](https://code.visualstudio.com/) [![](https://img.shields.io/badge/pkgManage-pnpm-brightgreen?logo=pnpm&style=flat-square)](https://code.visualstudio.com/)

### 相关技术栈

[![](https://img.shields.io/badge/-TypeScript-2496ED?style=flat-square&logo=typescript&logoColor=ffffff)](https://www.typescriptlang.org/) [![](https://img.shields.io/badge/-React-45B8D8?style=flat-square&logo=react&logoColor=ffffff)](https://beta.reactjs.org/) [![](https://img.shields.io/badge/-antd-blue?&logo=ant-design)](https://ant-design.gitee.io/index-cn) [![](https://img.shields.io/badge/-proComponent-orange?logo=ant-design)](https://procomponents.ant.design/) [![](https://img.shields.io/badge/-@antd/charts-critical?logo=graphql)](https://antv.vision/zh) [![](https://img.shields.io/badge/-jest-green?logo=jest)](https://jestjs.io/zh-Hans/) [![ docs by dumi](https://img.shields.io/badge/guide-dumi-blue)](https://d.umijs.org/) [![](https://img.shields.io/badge/base-umi-orange)](https://umijs.org/) [![](https://img.shields.io/badge/-unocss-yellowgreen?&logo=unocss)](https://uno.antfu.me/)

### 环境

[![](https://img.shields.io/badge/-node_v16+-green?logo=node.js)](https://nodejs.org/en/) [![](https://img.shields.io/badge/pnpm_v7+-blue?logo=pnpm&style=flat-square)](https://code.visualstudio.com/) [![](https://img.shields.io/badge/-webpack_v5+-red?logo=webpack)](https://www.webpackjs.com/)

## 理念

随着研发代码的增多, 工程日益复杂，代码复用和版本管理显得格外的繁琐，版本升级没有日志，相互依赖的包需要手动管理版本，以往的组件库独立开发的方式并没有很好的区分组件和组件之间的关系，往往只需要一种类型的组件，例如图表，但还是不得不安装一整个组件库，并没有很好的对组件进行区分，如哪些是图表组件，哪些是功能组件，哪些是业务组件等，造成组件库越来越大，编译打包效率降低，每次一个小改动就不得不直接发布一整个包预览效果，且无法支持本地调试等以下相关痛点。

- 组件耦合严重，组件代码量大
- 业务开发分工不明确，业务开发人员要关心非业务的代码
- 编译慢，效率低
- 无法对应用做增量编译&增量部署
- 相关包基础依赖可能会重复打包，如： lodash,moment...
- 管理、调试、追踪 bug 困难
- 不同项目之间 node、node-sass、webpack 等基础依赖版本不统一，切换增加心智负担。
- 不同项目可能存在技术栈不统一，如：状态管理，less,sass
- 分支管理混乱
- 多包多项目之间依赖关系复杂
- 第三方依赖库版本可能不一致
- 占用总空间大
- 不利于团队协作
- 无法针对主应用统一跑测试用例,发布时很难避免一些基本的错误发生
- 需要频繁切换项目
- 搭建独立的文档系统和其他子应用时，相关依赖又要单独管理，又有上述的症状
- 无法跨部门共享基建产物[资产元数据](/components/schema#资产元数据)

针对上述问题我们引入了 Monorepo 的概念，把以往的单一组件库拆分为职责更细化的包，架构更清晰，解耦，子应用隔离，并且做了严格的 CR，CI 机制(暂无 CD)、自动化构建、测试流水线、代码问题校验，工程化的最终目的是让业务开发可以 100% 聚焦在业务逻辑上[精读《Monorepo 的优势》](https://zhuanlan.zhihu.com/p/65533186), [现代化前端应用为什么越来越离不开 Monorepo](https://juejin.cn/post/6944877410827370504)

### 特性

- umi4.x: [快速构建 React 应用，react(V18.2),router(V6),集成 auto import, 微前端等插件。](https://umijs.org/)
- TypeScript: 所有代码提供强类型支持
- state management: Umi Model & Valtio
- unocss: [按需原子化 CSS 编译](https://uno.antfu.me/)
- ant5.x: [快速研发企业级中后台产品, 开箱即用的高质量 React 组件](https://ant-design.gitee.io/index-cn)
- theme ｜ layout: 完全兼容新版 antd5 特性，支持自定义配置主题，主题 token 接入 unocss 和 css，less 变量, 路由keep-alive 等。
- dumi2.x: [为组件开发场景而生的静态站点框架](https://d.umijs.org/)
- father: [帮助开发者更高效、高质量地研发 NPM 包、生成构建产物、再完成发布。](https://github.com/umijs/father)
- commontLint: [让你的 commits 更有意义](https://typicode.github.io/husky/#/)
- jest: [优雅、简洁的 JavaScript 测试框架](https://jestjs.io/zh-Hans/)
- proComponents: [页面级组件让中后台开发更简单](https://procomponents.ant.design/)
- CI / CD: 一整套发布操作流自动化流程， 打包构建 =>跑测试用例 => 选择发包（多个）=> 选择升级的主版本包 => 打版本 tag => 生成日志 change-log => 写入到 dumi 文档 => 发布 npm
- monorepos: 包和应用划分清晰，跨应用复用代码，按需安装，支持纯净模式，仅安装主应用和相关包依赖
- dev | build: 优化 dev & build 配置，无需担心打包相关问题和 dev 环境的研发体验。
- vscode integrate: [适配研发插件 monorepo-workspace，快速铺平应用，优化 commit 显示，加速研发效率](https://marketplace.visualstudio.com/items?itemName=folke.vscode-monorepo-workspace)
- vscode cofig：针对该项目特有的编辑器的配置优化，如多文件折叠，autosave...
- pwa: 支持离线访问，独立安装，缓存机制等[wrokbox](https://developer.chrome.com/docs/workbox/modules/workbox-webpack-plugin/)功能，增加首屏的打开速度。
- search: 支持全文内容动态拼音检索，纠错检索等。
- auto-import: 接入[unplugin-auto-import](https://github.com/antfu/unplugin-auto-import)插件，在应用中所有关于 react, antd, proComponents, ahooks, antd/icons 中的 api 可以不用导入直接使用，插件会自动导入需要的 API;
- CRUD: 丰富的业务组件，覆盖常用业务
- final: 一直都在持续更新中,只为更快更好的研发体验...

### 包划分

- [@vis/utils](/components/utils) 工具库，常用的工具函数或者 hooks 等，如 transformData,uuid,timeFormat....
- [@vis/test](/components/test) 这里你可以做任意操作，如测试 CI 自动化脚本，功能相关的东西，总之就是随便玩
- [@vis/charts](/components/charts) 基于[antv](https://antv.vision/zh)下大屏画布或者仪表板图表库二次封装后的组件，如：条形进度图，词云图，饼图等...
- [@vis/components](/components/components) 存放功能性组件，更偏向系统功能，如右键菜单，拖拽改变布局宽高...
- [@vis/common](/components/common) 业务相关通用组件， 如 二次封装，request 拦截等...
- [@vis/decorator](/components/common) 装饰器，包含 svg 渲染的所有动画和装饰，相比图片或者动图，可随意放大缩小，且轻量级。

### 子应用

防止后期主应用过大增加 dev 和编译负担，我们把以往的主应用下不相关的部分拆分成了独立的项目，然后使用微前端和模块联邦来对接子应用（代码共享和状态管理），这样整个应用能 hold 住未来不断扩张的业务线和人员开发，也不会出现在不同应用中组件库代码被重复打包。我们特意将组件库代码从主应用中抽离出来，每个独立的子应用共享主应用内导出的 exposes 文件夹下的模块。

- [/project/template]子应用模版

[相关子应用接入查看这里](http://10.28.184.132:8088/docs/#/guide/subapp)

## 命令

### 运行

我们所有的包管理都强制使用[pnpm](https://pnpm.io/zh/motivation)，在 monorepo 架构之上，pnpm 能极大发挥他的作用(设计初期就很好的考虑了当前复杂项目的痛点)，相比 yarn 和 npm，pnpm 能节约磁盘空间并提升安装速度，切避免了关于深度嵌套包的一些意外情况，如果你还没有接触了解过 pnpm,可以看看[相关文章](https://zhuanlan.zhihu.com/p/377593512), 而且当前已有众多[前端团队](https://pnpm.io/zh/users)和大部分主流开源项目抛弃 npm,yarn，开始接入 pnpm。

- `npm pure-install` 纯净模式，仅安装主应用和 packages 的依赖， 忽略所有子应用依赖
- `pnpm i` 安装
- `npm run dev` # 运行主项目
- `npm run build` # 打包主项目
- `npm run dev-project` # 运行项目下的子应用(visual, dashboard, dataModel, ....)
- `npm run build-lib` # 懒加载打包(esm 格式)package 下所有库(保留文件的引用关系)，能解耦主应用代码，避免重复打包
- `npm run build-dist` # 打包生产环境下 package 下所有库(压缩，生成单文件和 css),适用于给其他团队项目中使用，仅忽略 antd,proComponents,moment 库
- `npm run build-selectPkg` # 手动选择打包，防止后期包太多的情况全部打包消耗过多资源和时间
- `npm run doc` # 运行项目文档， 包含组件库文档和项目说明等
- `npm run test` # 跑测试用例

[更多](/guide/getting-started)

### 发布

- `npm run release` 提供界面交互可视化自动发包
- `npm run release:only` 手动修改版本号后发包 [查看更多](http://10.28.184.132:8088/docs/#/guide/publish)

### 部署

为了很好的区分应用和对应的路由，我们建议所有子应用使用 hash 路由开发，这样就能统一路由风格，增加路由的可读性，且能减少很多不必要的 nginx 配置 😊

`http://10.28.184.132:8088/dash/#/list?type=dashboard`

地址拆分解析：

- `http://10.28.184.132:8088` - 主机地址
- `/dash` - 路由的 history 用来区分子应用
- `/#/list` - hash 路由参数为子应用自己的路由
- `?type=dashboard` - 传参

[查看更多](http://10.28.184.132:8088/guide/#/guide/publish#部署)

## 相关工程插件

- [changeSets](https://github.com/changesets/changesets) :发包工具
<!-- - [dumi](https://d.umijs.org/zh-CN):文档工具
- [father-builder](https://github.com/umijs/father): 库打包工具
- [testing-library](https://testing-library.com/): react 测试库 -->
- [husky](https://typicode.github.io/husky/#/) 代码提交规范工具
- [jest](https://jestjs.io/zh-Hans/)：自动化测试框架
- [react chorme debug](https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en): react 调试 & 性能分析
- [vscode monorepo workspace](https://marketplace.visualstudio.com/items?itemName=folke.vscode-monorepo-workspace): monorepo 工程 vscode 插件，进一步优化你的开发体验

## 🖥 浏览器兼容性

- 现代浏览器和 Internet Explorer 11 (with [polyfills](https://stackoverflow.com/questions/57020976/polyfills-in-2019-for-ie11))
- [Electron](https://www.electronjs.org/)

| [![edge](https://raw.githubusercontent.com/alrra/browser-logos/master/src/edge/edge_48x48.png)](http://godban.github.io/browsers-support-badges/) | [![Edge](https://raw.githubusercontent.com/alrra/browser-logos/master/src/firefox/firefox_48x48.png)](http://godban.github.io/browsers-support-badges/) | [![chrome](https://raw.githubusercontent.com/alrra/browser-logos/master/src/chrome/chrome_48x48.png)](http://godban.github.io/browsers-support-badges/) | [![safari](https://raw.githubusercontent.com/alrra/browser-logos/master/src/safari/safari_48x48.png)](http://godban.github.io/browsers-support-badges/) | [![electron_48x48](https://raw.githubusercontent.com/alrra/browser-logos/master/src/electron/electron_48x48.png)](http://godban.github.io/browsers-support-badges/) |
| --- | --- | --- | --- | --- |
| Edge | last 2 versions | last 2 versions | last 2 versions | last 2 versions |
